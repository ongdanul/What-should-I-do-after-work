<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.elice.boardproject.activity.mapper.ActivityMapper">

    <!-- User ResultMap -->
    <resultMap id="User" type="com.elice.boardproject.user.entity.Users">
        <id property="userId" column="user_id"/>
        <result property="userName" column="user_name"/>
    </resultMap>

    <!-- Post ResultMap -->
    <resultMap id="Post" type="com.elice.boardproject.post.entity.PostDto">
        <id property="postId" column="post_id" />
        <result property="boardId" column="board_id" />
        <result property="postTitle" column="post_title" />
        <result property="postContent" column="post_content" />
        <result property="regDate" column="reg_date" />
        <result property="modDate" column="mod_date" />
        <result property="viewCount" column="view_count" />

        <association property="user" resultMap="User" column="user_id"/>
    </resultMap>

    <!-- Scrap resultMap -->
    <resultMap id="Scrap" type="com.elice.boardproject.scrap.entity.ScrapDto">
        <id property="scrapId" column="scrap_id"/>
        <result property="userId" column="user_id"/>
        <result property="postId" column="post_id"/>

        <association property="user" resultMap="User" column="user_id"/>
        <association property="post" resultMap="Post" column="post_id"/>
    </resultMap>

    <!-- 작성한 게시물 조회 -->
    <select id="findPostsByUserId" resultMap="Post">
        SELECT *
        FROM post A
                 JOIN users B
                      ON A.user_id = B.user_id
        WHERE A.user_id = #{userId}
        ORDER BY A.reg_date DESC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>

    <!-- Scrap 전체 목록 조회 -->
    <select id="findScrapsByUserId" resultMap="Scrap">
        SELECT *
        FROM scrap A
                 JOIN post B
                      ON A.post_id = B.post_id
                 JOIN users C
                      ON B.user_id = C.user_id
        WHERE A.user_id = #{userId}
        ORDER BY A.scrap_id DESC
            LIMIT #{pageSize} OFFSET #{offset}
    </select>

</mapper>
