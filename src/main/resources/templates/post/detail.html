<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>예시 페이지</title>
</head>
<body>
<main layout:fragment="content">
    <table border="1">
        <tr>
            <td th:text="|No.${post.postId}|">default value</td>
            <td>제목 :</td>
            <td th:text="${post.postTitle}">default value</td>
            <td th:text="|작성일시 : ${post.regDate}|">default value</td>
            <!--            <td th:text="|수정일시 : ${post.modDate}|">default value</td>-->
        </tr>
        <tr>
            <td th:text="${post.postContent}">default value</td>
        </tr>
        <tr>
            <td>
                <form th:action="@{/post/{postId}(postId=${post.postId})}" th:method="delete">
                    <button type="submit" class="button">삭제</button>
                </form>
            </td>
            <td>
                <a th:href="'/post/edit/'+${post.postId}">수정</a>

            </td>
            <td>
                <a th:href="'/post/list/'+${post.boardId}">목록</a>
            </td>
        </tr>
    </table>
    <div id="commentSection">
        <!-- 댓글 목록 표시 영역 -->
        <ul id="commentList">
            <!-- 댓글은 AJAX로 로딩됩니다 -->
        </ul>

        <!-- 댓글 작성 폼 -->
        <div>
            <input type="text" id="commentContent" placeholder="댓글을 입력하세요">
            <button onclick="addComment()">댓글 추가</button>
        </div>
    </div>

    <script th:inline="javascript">
        // 댓글 목록 로딩
        function loadComments() {
            fetch('/api/comment/[[${post.postId}]]', {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                const commentList = document.getElementById('commentList');
                commentList.innerHTML = ''; // 기존 목록 초기화
                data.forEach(comment => {
                console.log(comment)
                    const listItem = document.createElement('li');
                    listItem.id = `comment-${comment.id}`;
                    listItem.innerHTML = `
                        <span>${comment.user_id}: ${comment.comment_content} 등록일시 : ${comment.reg_date}</span>
                        <button onclick="editComment(${comment.comment_id})">수정</button>
                        <button onclick="deleteComment(${comment.comment_id})">삭제</button>
                    `;
                    commentList.appendChild(listItem);
                });
            })
            .catch(error => console.error('Error:', error));
        }

        // 초기 로딩 시 댓글 목록 불러오기
        document.addEventListener('DOMContentLoaded', function() {
            loadComments();
        });
    </script>

</main>
</body>
</html>